<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>基于tinyproxy的代理服务器搭建</title>
      <link href="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"/>
      <url>/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<p>腾讯云上基于tinyproxy搭建代理服务器<span id="more"></span></p><h1 id="1-背景"><a href="#1-背景" class="headerlink" title="1 背景"></a>1 背景</h1><p>研究生实验室用的交换机，用网线直连测试能有100M左右的速度，但当打开视频网站（如bilibili）、QQ音乐下载、steam下载时，会出现几乎是0的下载速度，故怀疑是学校方面限制了上网的环境。具体可能涉及到上网策略或是包的过滤什么的不是很懂，不过有朋友建议自己架设服务器作为代理，故有了这次尝试，也有一定的收获。</p><h1 id="2-服务器选择"><a href="#2-服务器选择" class="headerlink" title="2 服务器选择"></a>2 服务器选择</h1><p>根据现实情况选择，买服务器在校外架设是不现实的，所以先在腾讯云上用学生优惠价买了一个月的轻量级云服务器试水，单核CPU 2G内存 60G硬盘 6M带宽（穷，只能将就下） centOS，如下图：<br><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/centos.png" title="腾讯云centOS服务器"></p><h1 id="3-服务器配置"><a href="#3-服务器配置" class="headerlink" title="3 服务器配置"></a>3 服务器配置</h1><p>和一般的Linux差不多，不过centOS是属于RedHat阵营的，所以apt得用yum代替（小白一枚，一开始还以为是不是系统不完整）。</p><p>不过在配置之前，建议先进入云服务器的控制台，我的是腾讯云所以进入的是腾讯云服务器的控制台。重置下密码好进行第三方软件的远程登录。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE.png" title="服务器配置"></p><p>另外，还需要设置控制台的服务器防火墙，开放8888端口（或者其他不冲突的端口）。一开始因为没有在控制台开放8888端口，导致后面ping服务器通（ping端口在控制台防火墙中默认是开放了的），curl服务器不通，感觉就是防火墙的问题，在机缘巧合下发现了控制台的防火墙设置（(lll￢ω￢)）。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF.png" title="网络信息"></p><p>把8888端口（或者其他不冲突的端口）写入开放的规则就好了。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E8%A7%84%E5%88%99.png" title="创建新的规则"></p><p>之后使用重置密码后的账号和密码登录服务器，我用的是shell7，其他的诸如putty之类的应该也行。</p><p>之后就是一些软件更新和安装操作。</p><h1 id="4-配置代理服务器"><a href="#4-配置代理服务器" class="headerlink" title="4 配置代理服务器"></a>4 配置代理服务器</h1><p>因为我是直接用root用户登录的，所以前面就不需要加sudo等操作了，而且因为是云服务器，万一删除了系统文件后也比较方便重装，所以就直接用root账户进行下列操作了。</p><p>更新软件。</p><p><code>yum update</code></p><p>安装tinyproxy，算是一个轻量级的代理服务器软件。</p><p><code>yum install tinyproxy</code></p><p>安装包找不到可以先装这个再尝试。</p><p><code>yum install epel-release</code></p><p>使用文本编辑器修改配置参数，不过在此之前建议先备份一波原先的配置文件。</p><p><code>cp /etc/tinyproxy.conf /etc/tinyproxy.conf.old</code></p><p>使用nano编辑该文件（vim等文本编辑软件都行）</p><p><code>nano /etc/tinyproxy/tinyproxy.conf</code></p><p>将Port行的端口号改成你需要的端口号，默认为8888端口。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E4%BF%AE%E6%94%B9%E7%AB%AF%E5%8F%A3.png" title="修改端口"></p><p>在Allow中添加需要进行代理的主机的公网ip，在百度中搜索 本机ip 跳出来的就是本机的公网ip。或者，将所有Allow项都使用#注释掉，即允许所有ip连接该代理服务器。</p><p>Allow项大概用“PageDown”按键按6下左右就能找到，或者直接查找也行。因为懒得打马，Allow项的图片就不展示了（(￣▽￣)”）。记得完成修改后使用 ctrl+x退出时选择y保存后，按回车键完成保存（其他编辑器类似）。</p><p>之后重启服务。重启、开启和停止该服务的代码如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 重启tinyproxy服务</span><br><span class="line">service tinyproxy restart</span><br><span class="line"> </span><br><span class="line"># 开启tinyproxy服务</span><br><span class="line">service tinyproxy start</span><br><span class="line"> </span><br><span class="line"># 停止tinyproxy服务</span><br><span class="line">service tinyproxy stop</span><br></pre></td></tr></tbody></table></figure><p>为防止linux内的防火墙对端口的封锁，可以输入此语句，不输入不知道会不会有影响(●ˇ∀ˇ●)。</p><p><code>iptables -I INPUT -p tcp --dport 8888 -j ACCEPT</code></p><p>已经开启防火墙的，可能还需要如下语句（小白一枚，不太确定(⊙﹏⊙)）</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --zone=public --add-port=8888/tcp --permanent</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></tbody></table></figure><p>在主机（本机为win10）使用命令提示符cmd（快捷键win+r后输入cmd，或直接在任务栏的搜索框中输入cmd，打开命令提示符）验证代理服务器是否就绪，其他系统也类似：</p><p>方法1：代码格式为：curl -x 服务器IP:开放的端口 httpbin.org/get</p><p><code>curl -x 180.123.148.125:8888 httpbin.org/get</code></p><p>若有返回值，说明代理服务器可以用了，像这样：</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E8%BF%9E%E9%80%9A%E6%B5%8B%E8%AF%95.png" title="连通测试"></p><p>方法2：同样是在cmd中，输入代码：curl ip.sb –proxy 代理服务器公网ip:端口号，即：</p><p><code>curl ip.sb --proxy 180.123.148.125:8888</code></p><p>若返回了本机ip地址，即说明代理服务器可用。</p><h1 id="5-使用代理服务器"><a href="#5-使用代理服务器" class="headerlink" title="5 使用代理服务器"></a>5 使用代理服务器</h1><h2 id="5-1-浏览器使用代理服务器"><a href="#5-1-浏览器使用代理服务器" class="headerlink" title="5.1 浏览器使用代理服务器"></a>5.1 浏览器使用代理服务器</h2><p>本机是win10，若只是单纯的浏览器使用代理服务器上网，可以安装组件SwitchyOmega，以火狐浏览器为例。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E6%89%A9%E5%B1%95%E6%8F%92%E4%BB%B6.png" title="扩展插件"></p><p>打开扩展和主题，直接在搜索框搜索SwitchyOmega并安装。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E6%90%9C%E7%B4%A2%E6%8F%92%E4%BB%B6.png" title="搜索插件"></p><p>之后的切换只要在按钮中选择切换就行了。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%90%86.png" title="系统代理"></p><h2 id="5-2-系统使用代理"><a href="#5-2-系统使用代理" class="headerlink" title="5.2 系统使用代理"></a>5.2 系统使用代理</h2><p>打开Internet选项。其中一种方法是使用win+r打开运行框，输入control打开控制面板，选择Internet选项，在连接页面中选择局域网设置。</p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Internet%E5%B1%9E%E6%80%A7.png" title="Internet属性"></p><p>之后勾选为LAN使用代理服务器并写入代理服务器的地址和端口。</p><p>btw，在linux代理服务器中可以使用如下语句得到服务器的公网ip（或者在云服务器控制台中就有标明公网ip）。</p><p><code>curl icanhazip.com</code></p><p><img src="/2021/10/11/%E5%9F%BA%E4%BA%8Etinyproxy%E7%9A%84%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/LAN%E8%AE%BE%E7%BD%AE.png" title="LAN设置"></p><p>按下确定的那一刻，就完成了代理服务器的连接，以后不使用代理服务器的话取消勾选即可。</p><p>连接完成后，若使用浏览器时记得按那个插件小图标切换到系统代理模式，此时再在百度搜索框中输入本机ip的话，应该会跳出代理服务器的ip。</p><h1 id="6-一些问题和解决"><a href="#6-一些问题和解决" class="headerlink" title="6 一些问题和解决"></a>6 一些问题和解决</h1><h2 id="6-1-代理有时会失效的问题"><a href="#6-1-代理有时会失效的问题" class="headerlink" title="6.1 代理有时会失效的问题"></a>6.1 代理有时会失效的问题</h2><p>遇到过代理第二天使用时失效的情况，此时重启服务器就好了，不过为了不每次重启服务器都那么麻烦，或者为了不每天手动启动服务器，干脆弄了早上自动重启服务器，并且开机启动tinyproxy服务。</p><h3 id="6-1-1-定时重启服务器"><a href="#6-1-1-定时重启服务器" class="headerlink" title="6.1.1 定时重启服务器"></a>6.1.1 定时重启服务器</h3><p>在linux服务器端输入命令查看是否具有定时任务的库。</p><p><code>crontab -l</code></p><p>假如说没安装报错，那就多一步，安装crontab。</p><p><code>yum install vixie-cron crontabs</code></p><p>一般不报错就说明安装过了。</p><p>设置开机启动crontab</p><p><code>chkconfig crond on</code></p><p>启动crondtab</p><p><code>service crond start</code></p><p>开始添加定时任务。</p><p>首先，打开crontab的编辑模式。</p><p><code>crontab –e</code></p><p>此时会进入一个类似文本编辑器的界面，而且用法很像vim…..。</p><p>按 i 进入编辑模式，将光标移到最后一行的行末时按回车进入新的一行，并输入：</p><p><code>05 06 * * * /sbin/reboot</code></p><p>表示每天6点05分重启服务器，其他时间段也照着格式修改参数就行。</p><h3 id="6-1-2-设置开机启动tinyproxy服务"><a href="#6-1-2-设置开机启动tinyproxy服务" class="headerlink" title="6.1.2 设置开机启动tinyproxy服务"></a>6.1.2 设置开机启动tinyproxy服务</h3><p>启动Tinyproxy服务，并设置开机自启。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --level 345 tinyproxy on</span><br><span class="line">systemctl restart tinyproxy.service</span><br><span class="line">systemctl enable tinyproxy.service</span><br></pre></td></tr></tbody></table></figure><p>系统启动后，得执行一次：</p><p><code>service tinyproxy restart</code></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/weixin_33725807/article/details/89760274" title="关于tinyproxy问题处理">关于tinyproxy问题处理</a><br><a href="https://www.cnblogs.com/masako/p/11459496.html" title="使用tinyproxy进行ip代理">使用tinyproxy进行ip代理</a><br><a href="https://zhidao.baidu.com/question/30095449.html" title="linux的定时重启的具体命令">linux的定时重启的具体命令</a></p><h1 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h1><p>本人linux、网络小白，只是按照网上大佬的方法暂时完成了想要的功能，发现还不错，心血来潮就记录了一波。本来其实快要放弃了，因为ping得通，curl不通，以为学校服务器有防火墙拦截了，结果山穷水复疑无路，居然成功了。</p>]]></content>
      
      
      <categories>
          
          <category> 操作 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tinyproxy </tag>
            
            <tag> 服务器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown Magic</title>
      <link href="/2021/10/11/Magic-World-Magic-Code/"/>
      <url>/2021/10/11/Magic-World-Magic-Code/</url>
      
        <content type="html"><![CDATA[<p>Markdown语法</p><h1 id="Markdown-魔法"><a href="#Markdown-魔法" class="headerlink" title="Markdown 魔法"></a>Markdown 魔法</h1><span id="more"></span><h2 id="文字效果"><a href="#文字效果" class="headerlink" title="文字效果"></a>文字效果</h2><p><em>斜体</em><br><strong>粗体</strong><br><em><strong>加粗斜体</strong></em><br><del>删除线</del></p><!-- $$数学公式E=mc^2$$ --><blockquote><p>文字引用</p><blockquote><p>第二层嵌套</p></blockquote></blockquote><h2 id="代码效果"><a href="#代码效果" class="headerlink" title="代码效果"></a>代码效果</h2><p><code>行内代码</code><br>​<code> 多行代码 多行代码 ​</code></p><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><hr><p>+++</p><hr><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><ol><li>有序列表项</li></ol><ul><li>无序列表项</li></ul><ul><li>无序列表项</li></ul><ul><li>无序列表项<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><!-- ps：第一行：第一行要显示的，类似Thead第二行：对齐方式|:-----|左对齐，|:-----:|居中，|-----:|右对齐每列的宽度是根据对应列里最长的文本来决定 --><table><thead><tr><th align="left">排序方法</th><th align="left">平均情况</th><th align="left">最好情况</th><th align="left">最坏情况</th><th align="left">辅助空间</th><th align="left">稳定性</th></tr></thead><tbody><tr><td align="left">冒泡排序</td><td align="left">O(n²)</td><td align="left">O(nlogn)</td><td align="left">O(n²)</td><td align="left">O(1)</td><td align="left">稳定</td></tr><tr><td align="left">简单选择</td><td align="left">O(n²)</td><td align="left">O(n²)</td><td align="left">O(n²)</td><td align="left">O(1)</td><td align="left">稳定</td></tr><tr><td align="left">直接插入</td><td align="left">O(n²)</td><td align="left">O(n)</td><td align="left">O(n²)</td><td align="left">O(1)</td><td align="left">稳定</td></tr><tr><td align="left">希尔排序</td><td align="left">O(nlogn)~O(n²)</td><td align="left">O(n^1.3)</td><td align="left">O(n²)</td><td align="left">O(1)</td><td align="left">不稳定</td></tr><tr><td align="left">堆排序</td><td align="left">O(nlogn)</td><td align="left">O(nlogn)</td><td align="left">O(nlogn)</td><td align="left">O(1)</td><td align="left">不稳定</td></tr><tr><td align="left">归并排序</td><td align="left">O(nlogn)</td><td align="left">O(nlogn)</td><td align="left">O(nlogn)</td><td align="left">O(n)</td><td align="left">不稳定</td></tr><tr><td align="left">快速排序</td><td align="left">O(nlogn)</td><td align="left">O(nlogn)</td><td align="left">O(n²)</td><td align="left">O(nlogn)~O(n)</td><td align="left">不稳定</td></tr></tbody></table><h2 id="超链接"><a href="#超链接" class="headerlink" title="超链接"></a>超链接</h2><a href="https://www.example.com/" title="示例链接">示例链接</a><br><a href="https://www.example.com/">https://www.example.com/</a><h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><img src="/2021/10/11/Magic-World-Magic-Code/magic-castle.jpg" alt="示例图片" title="示例图片"><br><img src="/2021/10/11/Magic-World-Magic-Code/magic-castle.jpg"></li></ul><!-- 说明：在 Hexo中 插入图片时，请按照以下的步骤进行设置    1.将站点配置文件 中的 post_asset_folder 选项的值设置为 true    2.在站点文件夹中打开 git bash，输入命令 npm install hexo-asset-image --save 安装插件    3.这样，当使用 hexo new title 创建文章时，将同时在 source/_post 文件夹中生成一个与 title 同名的文件夹，我们只需将图片放进此文件夹中，然后在文章中通过 Markdown 语法进行引用即可    *例如，在资源文件夹（就是那个与 title 同名的文件夹）中添加图片 example.PNG，则可以在对应的文章中使用语句 ![示例图片](title/example.PNG "示例图片") 添加图片 --><h2 id="写作模板设置"><a href="#写作模板设置" class="headerlink" title="写作模板设置"></a>写作模板设置</h2><blockquote><p>/scaffolds/post.md就是新文章的模板,使用命令hexo new “title”创建文章时，Hexo会根据/scaffolds/post.md对新文章进行初始化</p></blockquote><!-- 示例：title: Markdown Magic<p>date: 1633913965000<br>tags:<br>categories:  –&gt;</p><h2 id="文章头部添加"><a href="#文章头部添加" class="headerlink" title="文章头部添加"></a>文章头部添加</h2><!-- title: Titledate: YYYY-MM-DD HH:MM:SStags: [tag1, tag2, ...]categories: category --><h2 id="首页显示"><a href="#首页显示" class="headerlink" title="首页显示"></a>首页显示</h2><p>只显示more标志前的内容以精简</p>]]></content>
      
      
      <categories>
          
          <category> 语法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> 魔法 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
